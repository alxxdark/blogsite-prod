{# Tek bir yorumu ve tüm çocuklarını çizen recursive parça #}
<div id="comment_{{ node.id }}" class="c-card mb-2">
  <div class="d-flex justify-content-between">
    <div>
      <strong>{{ node.user }}</strong>
      <span class="c-meta">• {{ node.created_at|timesince }} ago</span>
    </div>
  </div>

  <div class="mt-2">{{ node.comment|linebreaksbr }}</div>

  {# YORUM GÖRSELİ (varsa) #}
  {% if node.image %}
    <div class="mt-2">
      <img src="{{ node.image.url }}" alt="" style="max-width:100%;height:auto;border-radius:8px;">
    </div>
  {% endif %}

  <div class="c-actions mt-2">
    <a class="link-plain btn btn-sm btn-outline-secondary js-like-comment"
       href="{% url 'blogs:like_comment' node.id %}" data-id="{{ node.id }}">
      👍 Beğen (<span id="like-count-{{ node.id }}">{{ node.likes.count }}</span>)
    </a>

    {% if request.user.is_authenticated %}
      <span class="btn btn-sm btn-outline-secondary toggle-reply"
            data-target="reply-form-{{ node.id }}">↩️ Yanıtla</span>
    {% endif %}
  </div>

  {% if request.user.is_authenticated %}
    {# YANIT FORMU — AJAX; dosya yükleme için enctype gerekiyor #}
    <form id="reply-form-{{ node.id }}"
          class="mt-2 d-none js-reply-form c-reply"
          data-parent="{{ node.id }}"
          method="post"
          action=""
          enctype="multipart/form-data">
      {% csrf_token %}
      <input type="hidden" name="parent_id" value="{{ node.id }}">
      <div class="mb-2">
        <input type="text" name="comment" class="form-control" placeholder="Yanıt yaz..." required>
      </div>
      <div class="d-flex gap-2 align-items-center">
        <input type="file" name="image" accept="image/*" class="form-control form-control-sm" style="max-width:280px;">
        <button type="submit" class="btn btn-outline-primary btn-sm">Gönder</button>
      </div>
    </form>
  {% endif %}

  {# ÇOCUKLAR (limitsiz iç içe) #}
  <div class="c-indent mt-2" data-children="{{ node.id }}">
    {% for child in node.replies.all %}
      {% if child.is_visible|default:True %}
        {% include "comments/_comment_node.html" with node=child %}
      {% endif %}
    {% endfor %}
  </div>
</div>
