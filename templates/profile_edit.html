{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container mt-5" style="max-width:720px;">
  <h2 class="mb-3">Edit Profile</h2>

  {% if messages %}
    {% for m in messages %}
      <div class="alert alert-{{ m.tags }} mb-3">{{ m }}</div>
    {% endfor %}
  {% endif %}

  <form method="post" enctype="multipart/form-data" class="card p-3">
    {% csrf_token %}

    <div class="mb-3 d-flex align-items-center gap-3">
      <div>
        {% if request.user.profile.avatar %}
          <img id="avatarPreview" src="{{ request.user.profile.avatar.url }}" alt="Avatar"
               style="width:80px;height:80px;border-radius:50%;object-fit:cover;">
        {% else %}
          <img id="avatarPreview" src="{% static 'img/default-avatar.png' %}" alt="Avatar"
               style="width:80px;height:80px;border-radius:50%;object-fit:cover;">
        {% endif %}
      </div>
      <div class="flex-grow-1">
        <label class="form-label">Avatar</label>
        {{ form.avatar }}
        <small class="form-text text-muted">{{ form.avatar.help_text }}</small>
      </div>
    </div>

    <div class="mb-3">
      <label class="form-label">Bio</label>
      {{ form.bio }}
    </div>

    <button type="submit" class="btn btn-primary">Kaydet</button>
    <a href="{% url 'blogs:profile' request.user.username %}" class="btn btn-secondary ms-2">Vazgeç</a>
  </form>
</div>

<script>
  // Seçilen avatarı anında önizle
  const fileInput = document.getElementById('id_avatar');
  const preview = document.getElementById('avatarPreview');
  if (fileInput){
    fileInput.addEventListener('change', (e)=>{
      const f = e.target.files && e.target.files[0];
      if (!f) return;
      const url = URL.createObjectURL(f);
      preview.src = url;
    });
  }
</script>
{% endblock %}
